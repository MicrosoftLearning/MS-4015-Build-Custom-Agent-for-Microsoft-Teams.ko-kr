
랩: '사용자 지정 에이전트 만들기'
---
<!--
Edit the metadata above to manage the list of exercises in the home page of the GitHub site that gets generated.
You can delete the module and edit index.md in the root of the repo to customize the display so that only the exercises are listed
To enable GitHub page publishing, edit the Page settings for the repo and publish from the main branch
-->

# 사용자 지정 에이전트 만들기 및 테스트

이 연습에서는 사용자 지정 에이전트를 만들기 위한 기초 역할을 하는 Azure OpenAI 리소스를 만듭니다.

이 연습을 완료하는 데 약 **30**분 정도 소요됩니다. <!-- update with estimated duration -->

**참고:** 학습자는 자신의 환경에서 이 랩을 완료해야 합니다.

##  작업 1: Azure OpenAI 리소스 만들기 

먼저,

1. Edge 브라우저에서 **https://portal.azure.com**으로 이동합니다.
1. Azure Portal에 로그인합니다.
2. 화면의 왼쪽 위에서 **+ 리소스 만들기**를 클릭합니다.
1. 검색 상자에 **azure openai**를 입력하고 Enter 키를 누릅니다.
1. **Azure OpenAI**라는 결과가 옵션으로 표시되어야 합니다. 이 옵션의 왼쪽 아래 모서리에는 **만들기**라고 레이블된 단추가 있습니다. Press> **Create** > **Aure OpenAI**.
1. **Azure OpenAI 만들기** 페이지에서 다음 필드를 설정합니다. **참고:** 이 랩은 학습자의 환경에서 완료될 예정이므로 학습자는 **Subscription**, **Pricing Tier** 및 **Resource Group** 필드에 대한 값을 선택할 때 자신의 재량권을 사용해야 합니다.
   
   a. **Subscription** 이 필드를 채울 때 사용자 고유의 재량권을 사용합니다.
   
   b. **Resource Group** : 이 필드를 채울 때 사용자 고유의 재량권을 사용합니다.
   
   c. **Name** : 선택한 이름을 입력합니다.
   
   d. **가격 책정 계층**: 기본값은 **Standard S0**이지만 이 필드를 채울 때는 사용자 고유의 재량에 따라 사용합니다.
   
**다음**을 선택합니다.

7. 다음 페이지의 **네트워크** 탭에서 **인터넷을 포함한 모든 네트워크가 이 리소스에 액세스할 수 있는** 옵션을 선택합니다.
**다음**을 선택합니다.
8. **태그** 탭의 다음 페이지 아래에서 이름 및 값 필드를 비워 둡니다.
**다음**을 선택합니다.
9. 다음 페이지의 **검토 + 제출** 탭에서 **만들기**를 누릅니다.
10. 이 새로 만든 Azure OpenAI 리소스가 만들어지는 페이지로 이동됩니다. **배포 진행 중**이라는 단어가 표시됩니다. 이 리소스가 배포를 완료할 때까지 몇 초 동안 기다립니다. 리소스가 배포되면 **리소스로 이동** 단추를 클릭합니다.
11. **결과:** 이제 새로 만든 Azure OpenAI 리소스가 있는 페이지에 있게 됩니다. 페이지의 왼쪽 위 모서리에 있는 리소스의 이름을 확인하여 확인할 수 있습니다. 이 이름은 위의 5c단계에서 선택한 이름과 일치해야 합니다.


## 작업 2: Azure OpenAI 모델에 대한 RAG 구현

이 작업에서는 사용자 고유의 테스트 환경에 대한 데이터 원본을 사용하여 RAG를 구현하는 방법을 알아봅니다.

1. 새로 만든 Azure OpenAI 리소스 페이지에서 페이지 맨 위에 있는 리본에서 **Azure AI 파운드리 포털로 이동**을 클릭합니다.
2. **채팅 플레이그라운드**라는 새 페이지의 **설치** 아래에서 > **기본 모델**을 통한 **+새 배포 만들기**를 선택합니다.
3. **채팅 완료 모델 선택**이라는 팝업 창에서 아래로 스크롤하여 **gpt-4o** > **확인** 옵션을선택합니다.
4. **gtp-4o 모델 배포** 창에서 모든 항목을 기본 설정으로 두고 **배포**를 선택합니다.
5. **채팅 플레이그라운드** 페이지에서 **+ 데이터 원본 추가** 화면 아래쪽 근처에 있는 **데이터 추가**를 선택합니다.
6. **데이터 원본 선택 또는 추가** 창의 **데이터 원본 선택** 드롭다운을 선택한 후 **파일 업로드(미리 보기)** 를 선택합니다.
7. **데이터 원본**에 대한 다음 페이지에서 **데이터 원본 선택** 드롭다운이 **파일 업로드(미리 보기)** 로 설정되어 있는지 확인합니다.
   
   a. **Subscription** 필드에서 기본값이 선택되어 있는지 확인합니다.
   
    b. **Select Azure Blob storage resource** 필드에서 **새 Azure Blob Storage 리소스 만들기**를 선택한 후 **스토리지 계정 만들기**라는 새 창의 **기본 사항** 탭에서 **Subscription** 및 **Resource group** 필드가 기본값으로 설정되어 있는지 확인하고 **Resource group**에서 사용할 수 있는 유일한 값을 선택합니다. **인스턴스 세부 정보**에서 **스토리지 계정 이름**에 대한 이름을 지정합니다. 필드의 나머지 부분은 그대로 둡니다. **검토 + 만들기**를 선택합니다. **검토 + 만들기** 탭 아래에서 **만들기** 버튼을 선택합니다. Azure Blob Storage 리소스를 배포하는 데 잠시 시간이 소요됩니다.
   
   c. **채팅 플레이그라운드** 창으로 다시 이동합니다. **Select Azure Blob storage resource** 필드 옆의 새로 고침 단추를 선택한 후 위의 b단계에서 만든 리소스를 선택합니다. **CORS 켜기** 단추를 선택합니다.
   
8. **Select Azure AI Search resource** 필드의 경우 **새 Azure AI Search 리소스 만들기**를 선택합니다.  **Subscription** 및 **Resource group** 필드가 선택한 값으로 설정되어 있는지 확인합니다.

   **참고:** 이 랩은 학습자의 환경에서 완료될 예정이므로 학습자는 **Subscription** 및 **Resource Group** 필드에 대한 값을 선택할 때 자신의 재량에 따라 사용해야 합니다.

9. **Resource Group**에 대한 드롭다운 값을 클릭하여 결정한 옵션을 선택합니다. **서비스 이름**을 입력한 후 다른 모든 필드가 기본값으로 설정되어 있는지 확인하고 **검토 + 만들기** > **만들기**를 선택합니다. Azure AI Search 리소스를 배포하는 데 잠시 시간이 소요됩니다.
10. **채팅 플레이그라운드** 창으로 다시 이동합니다. **Select Azure Blob storage resource** 필드 옆의 새로 고침 단추를 선택하고 위의 9단계에서 만든 리소스를 선택합니다.
11. **Enter the index name** > **Next** 필드에 대한 이름을 입력합니다. 향후 작업에서 필요하므로 이 이름을 복사하여 액세스할 수 있는 위치에 붙여넣습니다.
12. **파일 업로드** 섹션에서 **파일 찾아보기**를 선택하고 파일 탐색기에서 **문서**로 이동하여 **ContosoAI ChipEnhance Perks Program.docx**, **ContosoAI Insurance Plans.docx**, **Overview of ContosoAI.docx**의 세 파일에 대해 모두  > **열기**를 선택합니다. 이제 이 세 파일이 창의 **파일 업로드** 페이지에 나타나면 **파일 업로드** > **다음**을 선택합니다.
13. **데이터 관리** 섹션에서 모든 항목을 기본값으로 두고 **다음**을 선택합니다.
14. **데이터 연결**에서 **API key** > **다음** > **저장 후 닫기**를 선택합니다.
15. **채팅 플레이그라운드** 창에서 창의 왼쪽 위에 있는 리본의 **코드 보기**를 선택합니다.
16. **샘플 코드** 창에서 첫 번째 필드의 오른쪽에 있는 드롭다운을 선택하고 **json**을 선택한 후 **키 인증**탭으로 전환합니다.
    
    a. 향후 **엔드포인트**, **API 키** 및 **Azure Search 리소스 키** 작업에서 필요하므로 다음 값을 복사하여 붙여넣습니다. 이 창을 열어 두면 예정된 작업에 대한 이러한 값을 수집할 수도 있습니다.

 ## 작업 3: 테스트 도구 및 Teams에서 사용자 지정 에이전트 만들기 및 테스트

이 작업에서는 사용자 지정 에이전트를 만들고 에이전트를 테스트합니다.

1. **Visual Studio Code**를 사용하여 ASP.NET 5 API 앱을 만드는 방법을 보여줍니다.
2. Visual Studio Code 창의 오른쪽에서 **Teams 도구 키트** 아이콘을 선택하고 **새 앱 만들기**를 선택한 후 드롭다운에서 **사용자 지정 엔진 에이전트**(참고: Teams 도구 키트 버전에 따라 **사용자 지정 Copilot**을 선택해야 할 수 있음)를 선택하고 **기본 AI 챗봇** > **JavaScript** > **Azure OpenAI**를 선택합니다.
3. 화면 맨 위에 있는 빈 상자에 먼저 다음을 입력합니다.

   a. 이전 작업의 **API 키** > **Enter**.

   b. 이전 작업의 **엔드포인트** > **Enter**.

   c. **Azure Open AI 배포 이름**의 경우 **gpt-4o** > **Enter**를 입력합니다.

   d. **프로젝트 룸 폴더가 있는 폴더를 선택**하려면 **기본 폴더**를 선택합니다.

   e. **애플리케이션 이름 입력**에 원하는 이름을 입력하고 **Enter** 키를 누른 다음 팝업 winod에서 **예, 작성자를 신뢰합니다**를 선택합니다.

   f. 위의 a-f 단계에서 새로 만든 앱의 새 VS Code 창에서 화면 왼쪽에 있는 **Teams 도구 키트** 아이콘으로 이동합니다.

   **참고:** Microsoft Teams 관리 센터에 대한 관리자 액세스 권한이 없는 사용자 환경에 대해서는 g-i 단계를 완료해야 합니다. 사용자에게 관리자 액세스 권한이 부여된 M365 테넌트가 있는 경우 대신 j-m 단계를 수행합니다.

   g. **계정** 섹션에서 **Microsoft 365에 로그인**을 클릭합니다. 이렇게 하면 브라우저에서 새 창이 열립니다. 제공된 자격 증명을 사용하여 로그인합니다.

   h. 앱의 VS Code 페이지로 다시 이동합니다. 이제 **계정 아래에 **사용자 지정 앱 업로드 사용**이라고 적힌 녹색 확인 표시가 나타납니다.

   i. **계정** 섹션에서 **Azure에 로그인**을 클릭합니다. 모든 팝업 창에서 **확인**을 클릭합니다. 이렇게 하면 브라우저에서 새 창이 열립니다. 제공된 자격 증명을 사용하여 로그인합니다.

   Microsoft Teams 관리 센터에 대한 관리자 액세스 권한이 부여된 M365 테넌트가 있는 사용자의 경우 위의 g-i 단계 대신 다음 단계를 수행합니다.

   j. https://admin.teams.microsoft.com관리자 자격 증명으로 로그인합니다.

   k. 사이드바에서 **Teams 앱** 으로 이동한 다음  **설정 정책**을 선택합니다.

   l.  **전역(조직 전체 기본값)**  정책을 선택한 다음  **사용자 지정 앱 업로드**  토글을 켭니다.

   m. 아래로 스크롤하고  **저장** 단추를 선택하여 변경 내용을 저장합니다. 이제 테넌트가 사용자 지정 앱 테스트용 로드를 허용합니다. 
   
5. 앱의 VS Code 창에서 **src/prompts/chat/skprompt.txt**로 이동합니다. 파일의 텍스트를 삭제하고 다음을 붙여넣습니다. "다음은 지정된 컨텍스트에 대한 질문에 대답하는 전문가인 AI 도우미와의 대화입니다. 

응답은 80단어 이하의 짧은 저널리즘 스타일이어야 합니다." 

5. 앱의 VS Code 창의 프롬프트/채팅에서 **config.json** 파일로 이동합니다. 현재 대괄호에 있는 코드를 삭제하고 다음 코드를 대괄호에 붙여넣습니다.

```json
"data_sources": [ 
    { 
        "type": "azure_search", 
        "parameters": { 
            "endpoint": "AZURE-AI-SEARCH-ENDPOINT", 
            "index_name": "YOUR-INDEX_NAME",
            "in_scope": false,
            "authentication": { 
                "type": "api_key", 
                "key": "AZURE-AI-SEARCH-KEY" 
            } 
        } 
    } 
]
```

6. 위의 코드에서 다음을 이전 작업에서 저장한 값으로 바꿉니다(참고: 값은 반드시 따옴표로 묶습니다).

   a. **AZURE-AI-SEARCH-ENDPOINT**는 이전 작업의 **엔드포인트**입니다.

   b. **index_name**은 이전 작업의 작업 2단계 11의 **인덱스 이름**입니다.

   c. **키** 는 이전 작업의 **Azure Search 리소스 키** 입니다.

7.  **src/app/app.js 파일**로 이동하여 azureEndpoint 줄 바로 다음의  **OpenAIModel** 내에 다음 변수를 추가합니다. config.azureOpenAIEndpoint,  

    a. azureApiVersion: '2024-02-15-preview',
   
8. **파일** > **모두 저장**
    
9. 키보드에서 **Ctrl+Shift+d**를 눌러 왼쪽 위에 녹색 재생 단추와 디버그라는 단어가 있는 드롭다운이 표시되면 드롭다운을 선택하고 **테스트 도구에서 디버그** 선택한 다음 **F5** 키를 누릅니다.
10.사용자 지정 엔진 에이전트는 선택한 디버깅 도구 내에서 실행되며 브라우저에서 열립니다. 작업 2 12단계에서 업로드된 RAG 데이터와 관련된 질문을 봇에 문의할 수 있습니다.
11. 앱의 VS Code 창으로 다시 이동합니다. **디버그** 단추 드롭다운을 선택하고 **Teams(Edge)에서 디버그**를 선택한 다음 **F5** 또는 녹색 재생 단추를 누릅니다.
13. Edge 브라우저에서 새 창이 열립니다. 다시 로그인하라는 메시지가 표시됩니다. 제공된 로그인 정보를 사용하여 로그인합니다. 성공적으로 로그인한 후에는 창을 닫을 수 있습니다.
14. 11단계를 반복합니다. 새로 만든 앱의 제목이 있는 창이 있어야 합니다. **추가** > **열기**를 선택합니다.
15. 축하합니다! 이제 RAG 데이터 파일과 관련된 질문을 에이전트에 문의할 수 있습니다.
16. **참고:** 이 에이전트는 사용자 고유의 구독을 사용하여 교육 목적으로 만들어졌으므로 사용자는 이 랩을 완료한 후 에이전트 삭제를 진행해야 합니다. Microsoft Teams에서 사용자 지정 에이전트를 삭제하려면 다음을 수행할 수 있습니다.
- 삭제하려는 에이전트를 선택한 다음 **기타 옵션 아이콘(...)** 을 선택하고 **삭제**를 선택합니다.
- 스레드에서 줄임표를 선택하고 **앱 관리**를 선택하여 채팅에서 에이전트를 제거합니다.
- 에이전트의 작성 경험에서 **줄임표(...)** 를 선택한 다음 **삭제**를 선택합니다.

**랩 종료**
